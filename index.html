<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BARBAR - Belajar Asik</title>
  <style>
    /* ========== STYLE.CSS DIGABUNG DI SINI ========== */

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #00111f, #000);
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    .screen {
      display: none;
      position: absolute;
      width: 100%;
      height: 100%;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      transition: opacity 0.6s ease;
    }

    .screen.active {
      display: flex;
    }

    /* Splash Screen */
    #splashScreen h1 {
      font-size: 3rem;
      color: #00ffff;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px #00ffff; }
      to { text-shadow: 0 0 30px #00ffff; }
    }

    /* Landing Screen */
    #landingScreen {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(0,0,0,0.8));
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
    }

    input {
      padding: 10px 15px;
      border: none;
      border-radius: 10px;
      width: 80%;
      margin-bottom: 10px;
    }

    button {
      padding: 10px 20px;
      background-color: #00ffff;
      color: #000;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #00cccc;
    }

    /* Main Screen */
    #mainScreen {
      flex-direction: column;
      padding: 20px;
      gap: 20px;
      overflow-y: auto;
    }

    .card {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 15px rgba(0,255,255,0.2);
    }

    .subject-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      background: rgba(0,255,255,0.2);
      border-radius: 10px;
      padding: 10px;
      color: #00ffff;
      font-weight: bold;
    }

    .question {
      margin: 20px 0;
    }

    .options button {
      width: 100%;
      margin: 5px 0;
    }

    .leaderboard {
      margin-top: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 10px;
    }

    .ai-mentor {
      margin-top: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 15px;
    }

    textarea {
      width: 100%;
      height: 60px;
      border-radius: 10px;
      border: none;
      padding: 10px;
    }
  </style>
</head>
<body>

  <!-- ========== SPLASH SCREEN ========== -->
  <div id="splashScreen" class="screen active">
    <h1>BARBAR</h1>
  </div>

  <!-- ========== LANDING SCREEN ========== -->
  <div id="landingScreen" class="screen">
    <h2>Selamat Datang di BARBAR</h2>
    <p>Masukkan namamu untuk mulai belajar</p>
    <input type="text" id="userNameInput" placeholder="Namamu..." />
    <button id="startBtn">Mulai Belajar</button>
  </div>

  <!-- ========== MAIN SCREEN ========== -->
  <div id="mainScreen" class="screen">
    <h2 id="welcomeText"></h2>
    <div id="subjectList" class="card"></div>

    <div id="quizSection" class="card" style="display:none;">
      <h3 id="quizTitle"></h3>
      <div id="questionContainer"></div>
    </div>

    <div class="leaderboard" id="leaderboard">
      <h3>üèÜ Leaderboard</h3>
      <ul id="leaderboardList"></ul>
    </div>

    <div class="ai-mentor">
      <h3>üß† Mentor AI</h3>
      <textarea id="mentorInput" placeholder="Tanyakan apa saja..."></textarea>
      <button id="askMentorBtn">Kirim</button>
      <div id="mentorResponse"></div>
    </div>
  </div>

  <script>
    /* ========== SCRIPT.JS DIGABUNG DI SINI ========== */

    const SUPABASE_URL = 'https://rgntufyuatlkikwuyrxx.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_Qb5hBsxj26EbriOtqipRBQ_a9HNxjx0';
    const supabase = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;

    const appState = {
      userName: '',
      points: 0,
      completed: {},
      openaiApiKey: ''
    };

    const SUBJECTS_DATA = {
      "Matematika": [
        {
          id: "m1",
          title: "Konsep Pecahan",
          video: "https://www.youtube.com/embed/DzS2kBShZT8",
          questions: [
            { q: "1/2 + 1/4 = ?", options: ["1/6", "3/4", "2/4"], a: "3/4" },
            { q: "2/3 - 1/6 = ?", options: ["1/2", "1/3", "5/6"], a: "1/2" }
          ]
        },
        {
          id: "m2",
          title: "Dasar Aljabar",
          video: "https://www.youtube.com/embed/2nKsN90i1n8",
          questions: [
            { q: "Jika x = 3, maka 2x + 1 = ?", options: ["5", "7", "8"], a: "7" }
          ]
        }
      ],
      "Biologi": [
        {
          id: "b1",
          title: "Sel & Jaringan",
          video: "https://www.youtube.com/embed/r3WkJ9WlP4M",
          questions: [
            { q: "Unit terkecil kehidupan adalah?", options: ["Sel", "Jaringan", "Organ"], a: "Sel" }
          ]
        }
      ]
    };

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function saveState() {
      localStorage.setItem('bb_state_v1', JSON.stringify(appState));
    }

    function loadState() {
      const data = localStorage.getItem('bb_state_v1');
      if (data) {
        const s = JSON.parse(data);
        appState.userName = s.userName || '';
        appState.points = s.points || 0;
        appState.completed = s.completed || {};
      }
    }

    function renderSubjects() {
      const container = document.getElementById("subjectList");
      container.innerHTML = "";
      Object.keys(SUBJECTS_DATA).forEach(subj => {
        const btn = document.createElement("button");
        btn.className = "subject-btn";
        btn.textContent = subj;
        btn.onclick = () => showSubject(subj);
        container.appendChild(btn);
      });
    }

    function showSubject(subj) {
      const topics = SUBJECTS_DATA[subj];
      const container = document.getElementById("subjectList");
      container.innerHTML = `<h3>${subj}</h3>`;
      topics.forEach(t => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h4>${t.title}</h4>
          <iframe width="100%" height="200" src="${t.video}" allowfullscreen></iframe>
          <button onclick="startQuiz('${subj}','${t.id}')">Mulai Kuis</button>
        `;
        container.appendChild(card);
      });
    }

    function startQuiz(subj, topicId) {
      const topic = SUBJECTS_DATA[subj].find(t => t.id === topicId);
      document.getElementById("quizSection").style.display = "block";
      document.getElementById("quizTitle").textContent = topic.title;
      const container = document.getElementById("questionContainer");
      container.innerHTML = "";
      topic.questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `<p>${i+1}. ${q.q}</p>`;
        const opts = document.createElement("div");
        opts.className = "options";
        q.options.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.onclick = () => {
            if (opt === q.a) {
              alert("‚úÖ Benar!");
              appState.points += 10;
              saveState();
            } else alert("‚ùå Salah");
          };
          opts.appendChild(btn);
        });
        div.appendChild(opts);
        container.appendChild(div);
      });
    }

    async function loadLeaderboard() {
      const ul = document.getElementById("leaderboardList");
      ul.innerHTML = "";
      if (!supabase) return;
      const { data } = await supabase.from('leaderboard').select('*').order('points', { ascending: false }).limit(5);
      if (data) {
        data.forEach(d => {
          const li = document.createElement("li");
          li.textContent = `${d.name}: ${d.points} pts`;
          ul.appendChild(li);
        });
      }
    }

    async function updateLeaderboard() {
      if (!supabase) return;
      await supabase.from('leaderboard').upsert({ name: appState.userName, points: appState.points });
      loadLeaderboard();
    }

    document.getElementById("startBtn").onclick = () => {
      const name = document.getElementById("userNameInput").value.trim();
      if (!name) return alert("Masukkan nama dulu!");
      appState.userName = name;
      saveState();
      document.getElementById("welcomeText").textContent = `Halo, ${name}! Selamat belajar üöÄ`;
      showScreen("mainScreen");
      renderSubjects();
      updateLeaderboard();
    };

    document.getElementById("askMentorBtn").onclick = async () => {
      const q = document.getElementById("mentorInput").value.trim();
      if (!q) return;
      const resp = document.getElementById("mentorResponse");
      resp.innerHTML = "‚è≥ Sedang berpikir...";
      try {
        const r = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${appState.openaiApiKey}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: q }]
          })
        });
        const j = await r.json();
        resp.innerHTML = j.choices?.[0]?.message?.content || "Gagal menjawab.";
      } catch (e) {
        resp.innerHTML = "‚ö†Ô∏è Gagal terhubung ke AI Mentor.";
      }
    };

    // Jalankan awal
    loadState();
    setTimeout(() => {
      if (appState.userName) {
        document.getElementById("welcomeText").textContent = `Halo, ${appState.userName}! Selamat belajar üöÄ`;
        showScreen("mainScreen");
        renderSubjects();
        updateLeaderboard();
      } else showScreen("landingScreen");
    }, 2000);
  </script>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
